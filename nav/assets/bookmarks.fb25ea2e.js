var t=Object.defineProperty,a=Object.prototype.hasOwnProperty,i=Object.getOwnPropertySymbols,e=Object.prototype.propertyIsEnumerable,s=(a,i,e)=>i in a?t(a,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[i]=e,o=(t,o)=>{for(var l in o||(o={}))a.call(o,l)&&s(t,l,o[l]);if(i)for(var l of i(o))e.call(o,l)&&s(t,l,o[l]);return t};import{A as l,r as n,p as c,b as r,o as d,e as u,f as m,F as k,m as g,t as b,g as p,d as f,u as h,q as v,s as y,w as L,v as T,x as w}from"./vendor.4f3f5914.js";import{_ as x,a as C}from"./BookmarkBlock.044cc569.js";import{a as _}from"./Confirm.ac1c753b.js";import{s as S,b as A,h as j,a as I,_ as V}from"./index.46b85415.js";function E(){const t=l("axios"),a=n([]),i=async()=>(a.value=await t.get("/tag"),a.value);return{tagList:a,getAllTags:i,createTag:async a=>{await t.post("/tag",a),i()},updateTag:async a=>{await t.put("/tag",a),i()},deleteTag:async a=>{await t.delete(`/tag/${a}`),await i()}}}const P={props:{pickedTagList:{type:Array,default:()=>[]},confirm:{type:Function,required:!0}},setup(){const{tagList:t,getAllTags:a}=E();return{tagList:t,getAllTags:a}},data:()=>({}),methods:{confirmHandler(){const t=[];this.tagList.forEach((a=>{a.picked&&t.push(a)})),this.confirm(t)},onClickTag(t){this.tagList[t].picked=!this.tagList[t].picked,this.confirmHandler()},hightLightPickedTag(){this.tagList.forEach((t=>{t.picked=!1;for(const a of this.pickedTagList)if(a.name===t.name){t.picked=!0;break}}))},refresh(t){t&&(t.target.style.animationPlayState="running"),this.getAllTags().then((()=>{this.confirm([]),this.hightLightPickedTag(),t&&(t.target.style.animationPlayState="paused")}))}},watch:{pickedTagList(){this.hightLightPickedTag()}},mounted(){this.refresh()}},B=p();c("data-v-69827363");const O={class:"box tag-picker"},U={class:"block tags"},$={class:"flex-end"};r();const F=B(((t,a,i,e,s,o)=>(d(),u("div",O,[m("div",U,[(d(!0),u(k,null,g(e.tagList,((t,a)=>(d(),u("span",{class:["tag",t.picked?"is-primary":""],onClick:t=>o.onClickTag(a),key:t.name},b(t.name),11,["onClick"])))),128))]),m("div",$,[m("i",{class:"iconfont iconshuaxin",onClick:a[1]||(a[1]=(...t)=>o.refresh&&o.refresh(...t))})])]))));P.render=F,P.__scopeId="data-v-69827363";const q=p();c("data-v-562b7798");const z={class:"tag-box"},H={class:"flex-between tip"},N={class:"button-group"},G={class:"bookmark-box"},M={class:"flex-between"},R={class:"tags picked-tags-box"},X={key:0,class:"empty-tip"};r();const D={expose:[],setup(t){const a=y(),{tagList:i,getAllTags:e}=E(),{addLinks:s,delLinks:c}=function(){const t=l("axios");return{addLinks:async function(a){await t.post("/link",a)}}}(),r=n([]),p=n(""),B=f({visible:!1,bookmark:{},tags:[]}),O=f({visible:!1,isSubmitting:!1,bookmark:{}});function U(){S(!0),A.getAll().then((t=>{S(!1),r.value=t;const i={};t.forEach((t=>{i[t.id]=o(o({},t),{tagIdList:t.tagList.map((t=>t.id))})})),a.commit("setBookmarks",i)}))}function $(t){O.bookmark=t,O.visible=!0}function F(){O.isSubmitting=!0,A.remove(O.bookmark.id).then((()=>{O.isSubmitting=!1,U()}))}function D(t){t?(B.title="书签",B.bookmark=o({},t),B.pickedTagList=t.tagList):(B.title="新增书签",B.bookmark={name:"",url:"",description:""},B.pickedTagList=[]),B.visible=!0}function J(){const t=this.modal.pickedTagList.map((t=>t.id));B.bookmark.id?(delete B.bookmark.tagList,A.update(o(o({},B.bookmark),{tagIdList:t})).then(U).catch(j)):A.add(B.bookmark).then((({id:a})=>{s({bookmarkId:a,tagIdList:t}).then(U)})).catch(j),window.scrollTo(0,Number.MAX_SAFE_INTEGER)}function K(t){p.value=`“${t.name}”关联的书签`,r.value=a.getters.getBookmarksByTagId(t.id)}function Q(){p.value="所有书签",r.value=a.getters.getBookmarks}e().then((t=>a.commit("setTags",t))),U();const W=n(!1);function Y(){W.value=!0,I().then((()=>{alert("已重置序列化文件")})).catch(j).finally((()=>{W.value=!1}))}const Z=n(!1);function tt(){let t;try{const a=B.bookmark.url.split(".");if(t=a[a.length-2]+"."+a[a.length-1],!t)throw new Error}catch(a){return void alert("请输入有效的链接")}B.bookmark.icon="",Z.value=!0,$axios.get(`https://service-j3cuc7cz-1257263957.sh.apigw.tencentcs.com/get-favicon/${t}`).then((t=>{B.bookmark.icon=t})).catch((()=>{alert("获取图标失败，请重试")})).finally((()=>{Z.value=!1}))}return(t,a)=>(d(),u(k,null,[m("main",null,[m("div",z,[(d(!0),u(k,null,g(h(i),(t=>(d(),u(x,{size:"medium",showBoxShadow:"",key:t.id,entity:t,onClick:a=>K(t)},null,8,["entity","onClick"])))),128))]),m("div",H,[m("span",{onClick:Q},b(p.value),1),m("div",N,[m("button",{onClick:Y,class:["button margin-r is-small is-ghost",{"is-loading":W.value}]},"重置序列化文件",2),m("button",{class:"button is-small is-inverted is-info",onClick:a[1]||(a[1]=t=>D())},"添加")])]),m("div",G,[m(v,{name:"flip-list",tag:"div"},{default:q((()=>[(d(!0),u(k,null,g(r.value,(t=>(d(),u(C,{onClickTag:K,key:t.name,entity:t,class:"flip-list-item",edit:D,del:$},null,8,["entity"])))),128))])),_:1})])]),m(_,{message:h(O).message,title:`确定要删除书签“${h(O).bookmark.name}”吗？`,isSubmitting:h(O).isSubmitting,visible:h(O).visible,"onUpdate:visible":a[2]||(a[2]=t=>h(O).visible=t),onConfirm:F},null,8,["message","title","isSubmitting","visible"]),m(_,{title:h(B).title,onConfirm:J,visible:h(B).visible,"onUpdate:visible":a[6]||(a[6]=t=>h(B).visible=t)},{default:q((()=>[m(V,{label:"名称",modelValue:h(B).bookmark.name,"onUpdate:modelValue":a[3]||(a[3]=t=>h(B).bookmark.name=t)},null,8,["modelValue"]),m(V,{label:"链接",modelValue:h(B).bookmark.url,"onUpdate:modelValue":a[4]||(a[4]=t=>h(B).bookmark.url=t)},null,8,["modelValue"]),m(V,{label:"描述",modelValue:h(B).bookmark.description,"onUpdate:modelValue":a[5]||(a[5]=t=>h(B).bookmark.description=t)},null,8,["modelValue"]),m(V,{label:"图标"},{default:q((()=>[m("p",M,[m("button",{class:["button margin-r",{"is-loading":Z.value}],onClick:tt},"获取图标",2),m("input",{class:"input",value:h(B).bookmark.icon},null,8,["value"]),L(m("img",{style:{width:"64px"},class:"margin-l round-border",src:h(B).bookmark.icon},null,8,["src"]),[[T,h(B).bookmark.icon]])])])),_:1}),m(V,{label:"关联标签"},{default:q((()=>{var t;return[m("div",R,[(d(!0),u(k,null,g(h(B).pickedTagList,(t=>(d(),u(x,{key:t.name,entity:t},null,8,["entity"])))),128)),(null==(t=h(B).pickedTagList)?void 0:t.length)?w("",!0):(d(),u("p",X," 暂无关联标签，请从下方选取 "))]),m(P,{pickedTagList:h(B).pickedTagList,confirm:t=>h(B).pickedTagList=t},null,8,["pickedTagList","confirm"])]})),_:1})])),_:1},8,["title","visible"])],64))},__scopeId:"data-v-562b7798"};export default D;
