var t=Object.defineProperty,a=Object.prototype.hasOwnProperty,e=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,s=(a,e,i)=>e in a?t(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i,o=(t,o)=>{for(var n in o||(o={}))a.call(o,n)&&s(t,n,o[n]);if(e)for(var n of e(o))i.call(o,n)&&s(t,n,o[n]);return t};import{z as n,r as l,p as c,b as r,o as d,e as u,f as k,F as m,m as g,t as b,g as p,d as f,u as h,n as v,w as y,v as L,q as T}from"./vendor.4ef9e6b8.js";import{_ as w,a as x}from"./BookmarkBlock.209acab4.js";import{a as C}from"./Confirm.aaeb0a7c.js";import{s as S,b as _,h as j,a as A,_ as I}from"./index.f79cac45.js";function V(){const t=n("axios"),a=l([]),e=async()=>(a.value=await t.get("/tag"),a.value);return{tagList:a,getAllTags:e,createTag:async a=>{await t.post("/tag",a),e()},updateTag:async a=>{await t.put("/tag",a),e()},deleteTag:async a=>{await t.delete(`/tag/${a}`),await e()}}}const E={props:{pickedTagList:{type:Array,default:()=>[]},confirm:{type:Function,required:!0}},setup(){const{tagList:t,getAllTags:a}=V();return{tagList:t,getAllTags:a}},data:()=>({}),methods:{confirmHandler(){const t=[];this.tagList.forEach((a=>{a.picked&&t.push(a)})),this.confirm(t)},onClickTag(t){this.tagList[t].picked=!this.tagList[t].picked,this.confirmHandler()},hightLightPickedTag(){this.tagList.forEach((t=>{t.picked=!1;for(const a of this.pickedTagList)if(a.name===t.name){t.picked=!0;break}}))},refresh(t){t&&(t.target.style.animationPlayState="running"),this.getAllTags().then((()=>{this.confirm([]),this.hightLightPickedTag(),t&&(t.target.style.animationPlayState="paused")}))}},watch:{pickedTagList(){this.hightLightPickedTag()}},mounted(){this.refresh()}},P=p();c("data-v-69827363");const B={class:"box tag-picker"},O={class:"block tags"},U={class:"flex-end"};r();const $=P(((t,a,e,i,s,o)=>(d(),u("div",B,[k("div",O,[(d(!0),u(m,null,g(i.tagList,((t,a)=>(d(),u("span",{class:["tag",t.picked?"is-primary":""],onClick:t=>o.onClickTag(a),key:t.name},b(t.name),11,["onClick"])))),128))]),k("div",U,[k("i",{class:"iconfont iconshuaxin",onClick:a[1]||(a[1]=(...t)=>o.refresh&&o.refresh(...t))})])]))));E.render=$,E.__scopeId="data-v-69827363";const z=p();c("data-v-e818c748");const F={class:"tag-box"},q={class:"flex-between tip"},H={class:"button-group"},N={class:"bookmark-box"},G={class:"flex-between"},M={class:"tags picked-tags-box"},R={key:0,class:"empty-tip"};r();const X={expose:[],setup(t){const a=v(),{tagList:e,getAllTags:i}=V(),{addLinks:s,delLinks:c}=function(){const t=n("axios");return{addLinks:async function(a){await t.post("/link",a)}}}(),r=l([]),p=l(""),P=f({visible:!1,bookmark:{},tags:[]}),B=f({visible:!1,isSubmitting:!1,bookmark:{}});function O(){S(!0),_.getAll().then((t=>{S(!1),r.value=t;const e={};t.forEach((t=>{e[t.id]=o(o({},t),{tagIdList:t.tagList.map((t=>t.id))})})),a.commit("setBookmarks",e)}))}function U(t){B.bookmark=t,B.visible=!0}function $(){B.isSubmitting=!0,_.remove(B.bookmark.id).then((()=>{B.isSubmitting=!1,O()}))}function X(t){t?(P.title="书签",P.bookmark=o({},t),P.pickedTagList=t.tagList):(P.title="新增书签",P.bookmark={name:"",url:"",description:""},P.pickedTagList=[]),P.visible=!0}function D(){const t=this.modal.pickedTagList.map((t=>t.id));P.bookmark.id?(delete P.bookmark.tagList,_.update(o(o({},P.bookmark),{tagIdList:t})).then(O).catch(j)):_.add(P.bookmark).then((({id:a})=>{s({bookmarkId:a,tagIdList:t}).then(O)})).catch(j),window.scrollTo(0,Number.MAX_SAFE_INTEGER)}function J(t){p.value=`“${t.name}”关联的书签`,r.value=a.getters.getBookmarksByTagId(t.id)}function K(){p.value="所有书签",r.value=a.getters.getBookmarks}i().then((t=>a.commit("setTags",t))),O();const Q=l(!1);function W(){Q.value=!0,A().then((()=>{alert("已重置序列化文件")})).catch(j).finally((()=>{Q.value=!1}))}const Y=l(!1);function Z(){let t;try{const a=P.bookmark.url.split(".");if(t=a[a.length-2]+"."+a[a.length-1],!t)throw new Error}catch(a){return void alert("请输入有效的链接")}P.bookmark.icon="",Y.value=!0,$axios.get(`https://service-j3cuc7cz-1257263957.sh.apigw.tencentcs.com/get-favicon/${t}`).then((t=>{P.bookmark.icon=t})).catch((()=>{alert("获取图标失败，请重试")})).finally((()=>{Y.value=!1}))}return(t,a)=>(d(),u(m,null,[k("main",null,[k("div",F,[(d(!0),u(m,null,g(h(e),(t=>(d(),u(w,{size:"medium",showBoxShadow:"",key:t.id,entity:t,onClick:a=>J(t)},null,8,["entity","onClick"])))),128))]),k("div",q,[k("span",{onClick:K},b(p.value),1),k("div",H,[k("button",{onClick:W,class:["button margin-r is-small is-ghost",{"is-loading":Q.value}]},"重置序列化文件",2),k("button",{class:"button is-small is-inverted is-info",onClick:a[1]||(a[1]=t=>X())},"添加")])]),k("div",N,[(d(!0),u(m,null,g(r.value,(t=>(d(),u(x,{onClickTag:J,key:t.name,entity:t,edit:X,del:U},null,8,["entity"])))),128))])]),k(C,{message:h(B).message,title:`确定要删除书签“${h(B).bookmark.name}”吗？`,isSubmitting:h(B).isSubmitting,visible:h(B).visible,"onUpdate:visible":a[2]||(a[2]=t=>h(B).visible=t),onConfirm:$},null,8,["message","title","isSubmitting","visible"]),k(C,{title:h(P).title,onConfirm:D,visible:h(P).visible,"onUpdate:visible":a[6]||(a[6]=t=>h(P).visible=t)},{default:z((()=>[k(I,{label:"名称",modelValue:h(P).bookmark.name,"onUpdate:modelValue":a[3]||(a[3]=t=>h(P).bookmark.name=t)},null,8,["modelValue"]),k(I,{label:"链接",modelValue:h(P).bookmark.url,"onUpdate:modelValue":a[4]||(a[4]=t=>h(P).bookmark.url=t)},null,8,["modelValue"]),k(I,{label:"描述",modelValue:h(P).bookmark.description,"onUpdate:modelValue":a[5]||(a[5]=t=>h(P).bookmark.description=t)},null,8,["modelValue"]),k(I,{label:"图标"},{default:z((()=>[k("p",G,[k("button",{class:["button margin-r",{"is-loading":Y.value}],onClick:Z},"获取图标",2),k("input",{class:"input",value:h(P).bookmark.icon},null,8,["value"]),y(k("img",{style:{width:"64px"},class:"margin-l round-border",src:h(P).bookmark.icon},null,8,["src"]),[[L,h(P).bookmark.icon]])])])),_:1}),k(I,{label:"关联标签"},{default:z((()=>{var t;return[k("div",M,[(d(!0),u(m,null,g(h(P).pickedTagList,(t=>(d(),u(w,{key:t.name,entity:t},null,8,["entity"])))),128)),(null==(t=h(P).pickedTagList)?void 0:t.length)?T("",!0):(d(),u("p",R," 暂无关联标签，请从下方选取 "))]),k(E,{pickedTagList:h(P).pickedTagList,confirm:t=>h(P).pickedTagList=t},null,8,["pickedTagList","confirm"])]})),_:1})])),_:1},8,["title","visible"])],64))},__scopeId:"data-v-e818c748"};export default X;
